var methods=new Array();methods[0]="method=Autenticacion";methods[1]="method=RecuperarClave";methods[2]="method=ListarTicketUsuario";methods[3]="method=OpcionesGestionReparaccion";methods[4]="method=DatosTicket";methods[5]="method=AbrirReparacion";methods[6]="method=RutaTicket";methods[7]="method=ModuloEquipoTicket";methods[8]="method=CodigoProblemaModuloEquipoTicket";methods[9]="method=Causal";methods[10]="method=CodigoCierre";methods[11]="method=CodigoReparacion";methods[12]="method=CerrarModuloEquipoTicket";methods[13]="method=CerrarReparacion";methods[14]="method=ParteModuloEquipoTicket";methods[15]="method=CerrarParteModuloEquipoTicket";methods[16]="method=StatusXMS";methods[17]="method=StatusXMSDetalle";methods[18]="method=Acepta";methods[19]="method=ResponderNovedad";methods[20]="method=CheckList";methods[21]="method=RegistroCheckList";methods[22]="method=NovedadTicket";methods[24]="method=BusquedaParte";methods[25]="method=NovedadSistema";methods[26]="method=IngenierosEnZona";methods[27]="method=ServiciosIngeniero";methods[28]="method=CambioIngeniero";methods[29]="method=RegistroNovedad";methods[30]="method=ObtenerNovedad";methods[31]="method=NovedadAlmacen";methods[32]="method=DevuelvePartes";methods[33]="method=SolicitarPartes";methods[34]="method=RecibePartes";methods[35]="method=RegistroPosicion";methods[36]="method=EnTransito";methods[37]="method=ModuloEquipo";methods[38]="method=AgregarModulo";methods[39]="method=ListarActividadesRelacionadas";methods[40]="method=ObtenerActividadRelacionada";methods[41]="method=ListarPartesSolicitadas";methods[42]="method=ListarNovedadAsignacion";methods[43]="method=ListarNovedadNoLeidasUsuario";methods[44]="method=SolicitarHistorial";methods[45]="method=MarcarNovedadLeida";methods[46]="method=ResumenCierre";methods[47]="method=NovedadAlmacenGeneral";methods[48]="method=EliminarParteSolicitud";var movil="movil=3183592508",url1="http://localhost/db3/app/",url="http://localhost/db3/app/?callback=?",map;function echoMovilidad(){setInterval(function(){capturePosition()},300000)}function capturePosition(){navigator.geolocation.getCurrentPosition(onPositionSucces,onPositionError)}function onPositionSucces(a){registroPosicion(a.coords.latitude,a.coords.longitude)}function onPositionError(a){$(".busqueda").html("");$(".busqueda").append("echo errorcode: "+a.code+"\nmessage: "+a.message+"\n")}function registroPosicion(d,c){var b="idUsuario",a;a=methods[35]+"&"+b+"="+sessionStorage.getItem(b)+"&latitud="+d+"&longitud="+c;$.getJSON(url,a,function(f){$(".busqueda").html("");$.mobile.loading("hide");if(!f.hasOwnProperty("success")){if(f.SATISFACTORIO==="True"){if(f.TIENEMENSAJES==="True"){var e="tienes "+f.CANTIDADMENSAJES+" mensajes, deseas leerlos";$("#page3 li #cantidad-mensajes").html("");$("#page3 li #cantidad-mensajes").append(f.CANTIDADMENSAJES);if(sessionStorage.getItem("mensaje")==="inactivo"){navigator.notification.confirm(e,aceptaMensajes,"mensajes","ok, cancel");sessionStorage.setItem("mensaje","activo")}}$(".busqueda").append("Enviando lat:"+d+", lon: "+c)}else{$(".busqueda").append("Posición no disponible")}}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}})}function aceptaMensajes(a){if(a==1){sessionStorage.setItem("mensaje","inactivo");$.mobile.changePage($("#page40"),{transition:"none"})}}var admin="False";function autentication(a){sessionStorage.clear();a=a+"&"+methods[0]+"&"+movil;$.ajax({url:url1,type:"POST",crossDomain:true,data:a,dataType:"text json",success:function(b){$.mobile.loading("hide");if(!b.hasOwnProperty("success")){if(b.SATISFACTORIA==="True"){if(b.ADMINISTRADOR==="True"){admin=b.ADMINISTRADOR;$("#menu4").show()}sessionStorage.setItem("idUsuario",b.IDUSUARIO);sessionStorage.setItem("mensaje","inactivo");$.mobile.changePage($("#page3"),{transition:"none"});$("#textinput1").val("");$("#textinput2").val("");capturePosition();echoMovilidad();registroPosicion(5,-74)}else{alert("usuario NO valido")}$("#btn-login").button("enable")}else{if(b.success==="error"){alert("error de conexión");$.mobile.loading("hide");$("#btn-login").button("enable")}else{$.mobile.loading("hide");$("#btn-login").button("enable")}}}}).error(function(){alert("error de conexión");$.mobile.loading("hide");$("#btn-login").button("enable")})}function recoveryPass(a){a=a+"&"+methods[1]+"&"+movil;$.ajax({url:url1,type:"POST",crossDomain:true,data:a,dataType:"text json",success:function(b){$.mobile.loading("hide");if(!b.hasOwnProperty("success")){if(b.USUARIOVALIDO==="True"){if(b.CORREOENVIADO==="True"){alert("se ha enviado un correo")}else{alert("No se pudo enviar correo")}}else{alert("usuario NO valido")}}else{if(b.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function listTicket(){var f,a,b=$("#page7 div[data-role='content']"),c="idUsuario",e=methods[2]+"&"+c+"="+sessionStorage.getItem(c),d="";b.html("");$.getJSON(url,e,function(i){if(!i.hasOwnProperty("success")){$.mobile.loading("hide");var j,h;b.append('<ul data-role="listview" data-divider-theme="b" data-inset="true" class="tickets"></ul>');if(i[0]===undefined){f=i.IDTICKET;a=i.IDREPARACION;h=i.ACCION;if(i.VALOR==="1"){j="verde.png"}else{if(i.VALOR==="2"){j="amarillo.png"}else{j="rojo.png"}}d+='<li data-theme="c" data-idticket='+f+" data-idreparacion="+a+'><a href="" data-transition="none" data-icon="arrow-r"><img src="img/'+j+'" style="margin-top:40%; margin-left:2%"/><h3>Ticket # '+f+"</h3><p ><br> "+h+" <br> "+i.ESTIMADO+"</p></a></li>"}else{for(var g in i){f=i[g].IDTICKET;a=i[g].IDREPARACION;h=i[g].ACCION;if(i[g].VALOR==="1"){j="verde.png"}else{if(i[g].VALOR==="2"){j="amarillo.png"}else{j="rojo.png"}}d+='<li data-theme="c" data-idticket='+f+" data-idreparacion="+a+'><a href="" data-transition="none" data-icon="arrow-r"><img src="img/'+j+'" style="margin-top:40%; margin-left:2%"/><h3>Ticket # '+f+"</h3><p ><br> "+h+" <br> "+i[g].ESTIMADO+"</p></a></li>"}}$("#page7 div[data-role='content'] ul").html(d);$(".tickets").listview({create:function(k,l){$(".tickets li").click(function(m){sessionStorage.setItem("idTicket",$(this).data("idticket"));sessionStorage.setItem("idReparacion",$(this).data("idreparacion"));$("div.titulo-reporte-servicio").html("");$("div.titulo-reporte-servicio").append("<p><strong>Ticket#: "+sessionStorage.getItem("idTicket")+"</strong></p>");$.mobile.loading("show");sessionStorage.removeItem("modulo");reloadMenuOption()})}})}else{if(i.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function loadNumService(){var d=0,a,b="idUsuario",c=methods[2]+"&"+b+"="+sessionStorage.getItem(b);$.getJSON(url,c,function(f){$.mobile.loading("hide");if(!f.hasOwnProperty("success")){if(f[0]===undefined){d++}else{for(var e in f){d++}}}$("li span#num-servicios").html("");$("li span#num-servicios").append(d)})}function opcionesGestionReparaccion(){$.mobile.loading("show");var b="idTicket",c="",a=$('#page5 div[data-role="content"] #list-service');formData=methods[3]+"&"+b+"="+sessionStorage.getItem(b);a.html("");$.getJSON(url,formData,function(f){if(!f.hasOwnProperty("success")){cantidadTareas();if(f[0]===undefined){c+='<li data-role="list-divider" role="heading">'+f.NOMBRE+"</li>";if(f.MENUSHIJOS.MENUHIJO[0]===undefined){navega=f.MENUSHIJOS.MENUHIJO.NAVEGACIONMOVILIDAD;if(typeof(navega)==="object"){navega=""}c+='<li data-theme="c" id="acciones-'+f.MENUSHIJOS.MENUHIJO.NAVEGACIONMOVILIDAD+'" ><a id="acc-a'+f.MENUSHIJOS.MENUHIJO.NAVEGACIONMOVILIDAD+'" href="#'+navega+'" data-transition="none">'+f.MENUSHIJOS.MENUHIJO.NOMBRE+"</a></li>"}else{for(var d in f.MENUSHIJOS.MENUHIJO){navega=f.MENUSHIJOS.MENUHIJO[d].NAVEGACIONMOVILIDAD;if(typeof(navega)==="object"){navega=""}c+='<li data-theme="c" id="acciones-'+f.MENUSHIJOS.MENUHIJO[d].NAVEGACIONMOVILIDAD+'" ><a id="acc-a'+f.MENUSHIJOS.MENUHIJO[d].NAVEGACIONMOVILIDAD+'" href="#'+navega+'" data-transition="none">'+f.MENUSHIJOS.MENUHIJO[d].NOMBRE+"</a></li>"}}a.html(c);a.find("#acc-apage12").append('<span class="ui-li-count" id="num-tareas"></span>')}else{for(var e in f){c+='<li data-role="list-divider" role="heading">'+f[e].NOMBRE+"</li>";if(f[e].MENUSHIJOS.MENUHIJO[0]===undefined){navega=f[e].MENUSHIJOS.MENUHIJO.NAVEGACIONMOVILIDAD;if(typeof(navega)==="object"){navega=""}c+='<li data-theme="c" id="acciones-'+f[e].MENUSHIJOS.MENUHIJO.NAVEGACIONMOVILIDAD+'" ><a id="acc-a'+f[e].MENUSHIJOS.MENUHIJO.NAVEGACIONMOVILIDAD+'" href="#'+navega+'" data-transition="none">'+f[e].MENUSHIJOS.MENUHIJO.NOMBRE+"</a></li>"}else{for(var d in f[e].MENUSHIJOS.MENUHIJO){navega=f[e].MENUSHIJOS.MENUHIJO[d].NAVEGACIONMOVILIDAD;if(typeof(navega)==="object"){navega=""}c+='<li data-theme="c" id="acciones-'+f[e].MENUSHIJOS.MENUHIJO[d].NAVEGACIONMOVILIDAD+'" ><a id="acc-a'+f[e].MENUSHIJOS.MENUHIJO[d].NAVEGACIONMOVILIDAD+'" href="#'+navega+'" data-transition="none">'+f[e].MENUSHIJOS.MENUHIJO[d].NOMBRE+"</a></li>"}}a.html(c);a.find("#acc-apage12").append('<span class="ui-li-count" id="num-tareas"></span>')}}}else{alert("problema al cargar el menu")}$.mobile.loading("hide");$("#acc-apage15").click(function(g){g.preventDefault();document.getElementById("form-novedades-ticket").reset();$("#form-novedades-ticket").data("novedad","2");$("#back-novedad").attr("href","#page5");novedadesTicket()});$("#list-service").listview({create:function(g,h){}});$("#list-service").listview("refresh")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function dataTicket(){var a="",b=$("#page10 div[data-role='content'] div.body-content"),c="idReparacion",d=methods[4]+"&"+c+"="+sessionStorage.getItem(c);b.html("");$.getJSON(url,d,function(e){$.mobile.loading("hide");if(!e.hasOwnProperty("success")){if(e.CITA==="True"){a="Cita"}b.append("<div><p>Servicio <b>"+a+"</b>&nbsp;de&nbsp;<b>"+e.LINEASERVICIO+"</b> para el equipo <b>"+e.LUNO+"</b> del cliente: <b>"+e.CLIENTE+"</b> con serial <b>"+e.SERIAL+".</b>&nbsp; Ubicado en la ciudad de: &nbsp;<b>"+e.CIUDAD+"</b> Direccion: <b>"+e.DIRECCION+".&nbsp;</b></p><p>Fecha y hora de contacto: <b>"+e.FECHAGENERACION+"&nbsp;</b>&nbsp;&nbsp;&nbsp;Fecha y hora de estimado o Cita: <b>"+e.FECHAEFECTIVA+".</b></p><p>El problema reportado es: <b>"+e.DESCRIPCIONFALLA+".</b></p></div>")}else{if(e.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function routeticket(){var b,a="idReparacion";b=methods[6]+"&"+a+"="+sessionStorage.getItem(a);$.getJSON(url,b,function(f){var d=[];if(!f.hasOwnProperty("success")){if(f[0]===undefined){var c=[];g=f.LATITUD.replace(",",".");j=f.LONGITUD.replace(",",".");i=f.NOMBRE;c.nombre=i;c.LatLng=new google.maps.LatLng(g,j);d=c;if(f.TIPO==="INGENIERO"){center=new google.maps.LatLng(g,j);initialize(center,d)}routeMap(d)}else{for(var e in f){var c=[];g=f[e].LATITUD.replace(",",".");j=f[e].LONGITUD.replace(",",".");i=f[e].NOMBRE;c.nombre=i;c.LatLng=new google.maps.LatLng(g,j);d[e]=c;if(f[e].TIPO==="INGENIERO"){center=new google.maps.LatLng(g,j);initialize(center,d)}}routeMap(d)}}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide");var g=0,j=0,i="",h=[];center=new google.maps.LatLng(g,j);h.nombre=i;h.LatLng=center;d[0]=h;initialize(center,d)}else{$.mobile.loading("hide");var g=0,j=0,i="",h=[];center=new google.maps.LatLng(g,j);h.nombre=i;h.LatLng=center;d[0]=h;initialize(center,d)}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}var map1;function initialize(a,c){$.mobile.loading("hide");var b={zoom:14,center:a,mapTypeId:google.maps.MapTypeId.ROADMAP},d=$("#page10 #map_canvas");d.height(screen.height*0.3);map1=new google.maps.Map(d[0],b)}function markerMap(b){for(var c in b){var a=new google.maps.Marker({position:b[c].LatLng,map:map1,title:b[c].nombre})}}function routeMap(a){var e=new google.maps.DirectionsService(),c=new google.maps.DirectionsRenderer(),b=new google.maps.LatLngBounds(a[0].LatLng,a[1].LatLng);c.setMap(map1);map1.fitBounds(b);var d={origin:a[0].LatLng,destination:a[1].LatLng,travelMode:google.maps.TravelMode.WALKING};e.route(d,function(f,g){if(g==google.maps.DirectionsStatus.OK){c.setDirections(f)}})}function aceptarCaso(){var b,a="idReparacion";b=methods[18]+"&"+a+"="+sessionStorage.getItem(a);$.getJSON(url,b,function(c){if(!c.hasOwnProperty("success")){if(c.SATISFACTORIO==="True"){alert("Servicio aceptado");reloadMenuOption()}else{alert("No se pudo aceptar el servicio");$.mobile.changePage($("#page5"),{transition:"none"})}}else{if(c.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function reloadMenuOption(){$.mobile.changePage($("#page5"),{transition:"none"});opcionesGestionReparaccion()}function transitoCaso(){var b,a="idReparacion";b=methods[36]+"&"+a+"="+sessionStorage.getItem(a);$.getJSON(url,b,function(c){if(!c.hasOwnProperty("success")){if(c.SATISFACTORIO==="True"){alert("Servicio en tránsito");reloadMenuOption()}else{alert("No se pudo poner el servicio en tránsito");$.mobile.changePage($("#page5"),{transition:"none"})}}else{if(c.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function solicitarHistorial(){var c,a="idTicket",b="idUsuario";c=methods[44]+"&"+a+"="+sessionStorage.getItem(a)+"&"+b+"="+sessionStorage.getItem(b);$.getJSON(url,c,function(d){if(!d.hasOwnProperty("success")){if(d.SATISFACTORIO==="True"){alert("Se ha enviado solicitud");reloadMenuOption()}else{alert("No se pudo enviar solicitud");$.mobile.changePage($("#page5"),{transition:"none"})}}else{if(d.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function opencase(e){e=e.replace(/%3A/gi,":");e=e.replace(/'+'/gi," ");var f=e.split("&"),d="idReparacion",b=new Date();if((f[0].split("="))[1]==="true"){f[1]=(f[1].split("="))[0]+"="+b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();f[2]=(f[2].split("="))[0]+"="+b.getHours()+":"+b.getMinutes();f[1]+=" "+(f[2].split("="))[1];if((f[4].split("="))[1]==="hora"){f.splice(2,4)}else{f.splice(2,3)}}else{var a="fecha=";if((f[3].split("="))[1]==="hora"){a+=b.getFullYear()+"-"+(f[1].split("="))[1]+"-"+(f[2].split("="))[1];f.splice(2,2)}else{a+=(f[3].split("="))[1]+"-"+(f[1].split("="))[1]+"-"+(f[2].split("="))[1];f[1]=a;f[1]+=" "+(f[4].split("="))[1];f.splice(2,3)}}e=f[0];for(var c=1;c<f.length;c++){e+="&"+f[c]}e=e+"&"+methods[5]+"&"+d+"="+sessionStorage.getItem(d);$.getJSON(url,e,function(g){$.mobile.loading("hide");if(!g.hasOwnProperty("success")){if(g.APERTURASATISFACTORIA==="True"){alert("Servicio abierto");reloadMenuOption()}else{alert("No se pudo abrir el servicio");$.mobile.changePage($("#page5"),{transition:"none"})}$("#btn-open-case").button("enable")}else{if(g.success==="error"){alert("error de conexión");$("#btn-open-case").button("enable");$.mobile.loading("hide")}else{$("#btn-open-case").button("enable");$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$("#btn-open-case").button("enable");$.mobile.loading("hide")})}function cantidadTareas(){var d=true,e=0,c,b="idTicket",a=$("#page12 div[data-role='content'] div[data-role='collapsible-set']");c=methods[7]+"&"+b+"="+sessionStorage.getItem(b);a.html("");$.ajax({url:url,dataType:"json",async:true,data:c,success:function(g){if(!g.hasOwnProperty("success")){for(var f in g){e++}$("li span#num-tareas").html("");$("li span#num-tareas").append(e);$(".module-collapse").collapsible({create:function(h,i){}})}sessionStorage.setItem("modulo","{}")}})}function moduletickets(){var d=true,e=0,c,b="idTicket",a=$("#page12 div[data-role='content'] div[data-role='collapsible-set']");c=methods[7]+"&"+b+"="+sessionStorage.getItem(b);a.html("");$.ajax({url:url,dataType:"json",async:true,data:c,success:function(g){if(!g.hasOwnProperty("success")){for(var f in g){e++;problema=g[f].DESCRIPCIONPROBLEMA;if(typeof(g[f].DESCRIPCIONPROBLEMA)==="object"){problema=""}a.append('<div data-role="collapsible" data-collapsed="false"  class="module-collapse" ><h3>Modulo: '+g[f].ALIAS+"</h3><div><p><b>"+problema+'</b></p></div><form data-ajax="false" id="form-module'+f+'" data-namemodulo="'+g[f].ALIAS+'" data-idmoduleticket="'+g[f].IDMODULOEQUIPOTICKET+'" autocomplete="off"></form></div>')}$("li span#num-tareas").html("");$("li span#num-tareas").append(e);$(".module-collapse").collapsible({create:function(h,i){}});loadoptions(false)}else{if(g.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("#acc-apage12").attr("href","#page12");sessionStorage.setItem("modulo","{}")}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function loadoptions(c){var b=$("#page12 div[data-role='content'] div[data-role='collapsible-set']");var a=b.children("div[data-role='collapsible']");b.children("div[data-role='collapsible']").find("form").html("");a.each(function(){moduleticketsproblems($(this).find("form").data("idmoduleticket"));ParteModuloEquipoTicket($(this).find("form").data("idmoduleticket"))});moduleticketsreparacion();moduleticketscausals();moduleticketscierre();moduleticketstimedescription()}function moduleticketsproblems(a){$.mobile.loading("show");var d,c="",b=$("#page12 div[data-role='content'] div[data-role='collapsible-set'] form[data-idmoduleticket='"+a+"']");d=methods[8]+"&idModuloEquipoTicket="+a;b.find("div#problems-menu1"+a).html("");b.append('<div data-role="fieldcontain" class="problems-menu1" id="problems-menu1'+a+'"></div>');$.getJSON(url,d,function(f){if(!f.hasOwnProperty("success")){b.find("div#problems-menu1"+a).append('<label for="IDCODIGOPROBLEMA">Problema</label><select data-role="none" name="IDCODIGOPROBLEMA" id="selectmenu1'+a+'" class="problema"></select>');if(f[0]===undefined){c+="<option value="+f.IDCODIGOPROBLEMA+">"+f.NOMBRE+"</option>"}else{for(var e in f){c+="<option value="+f[e].IDCODIGOPROBLEMA+">"+f[e].NOMBRE+"</option>"}}$("select#selectmenu1"+a).html(c);$("div select#selectmenu1"+a).selectmenu({create:function(g,h){}});b.find('div[data-role="fieldcontain"]').fieldcontain("refresh");$.mobile.loading("hide")}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function moduleticketscausals(){$.mobile.loading("show");var c,b="",a=$("#page12 div[data-role='content'] div[data-role='collapsible-set'] div[data-role='collapsible'] form");c=methods[9];a.find("div.causal-menu2").html("");a.append('<div data-role="fieldcontain" class="causal-menu2" ></div>');$.getJSON(url,c,function(e){if(!e.hasOwnProperty("success")){a.find("div.causal-menu2").append('<label for="IDCAUSAL">Causal</label><select data-role="none" name="IDCAUSAL" class="causal"></select>');$("div select.causal").selectmenu({create:function(f,g){}});if(e[0]===undefined){b+="<option value="+e.IDCAUSAL+">"+e.DESCRIPCION+"</option>"}else{for(var d in e){b+="<option value="+e[d].IDCAUSAL+">"+e[d].DESCRIPCION+"</option>"}}$("select.causal").html(b);a.find('div[data-role="fieldcontain"]').fieldcontain("refresh");$("div select.causal").selectmenu("refresh")}else{if(e.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function moduleticketscierre(){$.mobile.loading("show");var d,b="idTicket",c="",a=$("#page12 div[data-role='content'] div[data-role='collapsible-set'] div[data-role='collapsible'] form");d=methods[10]+"&"+b+"="+sessionStorage.getItem(b);a.find("div.cierre-menu3").html("");a.append('<div data-role="fieldcontain" class="cierre-menu3" ></div>');$.getJSON(url,d,function(f){if(!f.hasOwnProperty("success")){a.find("div.cierre-menu3").append('<label for="IDCODIGOCIERRE">Cierre</label><select data-role="none" name="IDCODIGOCIERRE" class="cierre"></select>');if(f[0]===undefined){c+="<option value="+f.IDCODIGOCIERRE+">"+f.DESCRIPCION+"</option>"}else{for(var e in f){c+="<option value="+f[e].IDCODIGOCIERRE+">"+f[e].DESCRIPCION+"</option>"}}$("select.cierre").html(c);$("div select.cierre").selectmenu({create:function(g,h){}})}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")});$("div select.cierre").selectmenu("refresh")}function moduleticketsreparacion(){$.mobile.loading("show");var b,a="";key="idTicket",$page=$("#page12 div[data-role='content'] div[data-role='collapsible-set'] div[data-role='collapsible'] form");b=methods[11]+"&"+key+"="+sessionStorage.getItem(key);$page.find("div.reparacion-menu4").html("");$page.append('<div data-role="fieldcontain" class="reparacion-menu4" data-reparacion=""></div>');$.getJSON(url,b,function(d){if(!d.hasOwnProperty("success")){$page.find("div.reparacion-menu4").append('<label for="IDREPARACION">Reparación</label><select data-role="none" name="IDCODIGOREPARACION" class="reparacion"></select>');if(d[0]===undefined){a+="<option value="+d.IDCODIGOREPARACION+">"+d.DESCRIPCION+"</option>"}else{for(var c in d){a+="<option value="+d[c].IDCODIGOREPARACION+">"+d[c].DESCRIPCION+"</option>"}}$("select.reparacion").html(a);$("div select.reparacion").selectmenu({create:function(e,f){}})}else{if(d.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")});$("div select.reparacion").selectmenu("refresh")}var indica=0;function moduleticketstimedescription(){indica++;var a=$('#page12 div[data-role="content"] div[data-role="collapsible-set"] div[data-role="collapsible"] form');a.find("div.idtime-description").html("");a.append('<div data-role="fieldcontain" class="idtime-description"><fieldset data-role="controlgroup"><label for="TIEMPOREPARACION">Tiempo reparación (en minutos)</label><input type="number" name="TIEMPOREPARACION" data-role="none" class="textinput-time" placeholder="minutos" value="0" data-highlight="true" /></fieldset></div><div data-role="fieldcontain" class="idtime-description"><fieldset data-role="controlgroup" class="idja"><label for="DESCRIPCION" class="lab">Descripción </label><textarea name="DESCRIPCION" class="texarea-description" placeholder=""></textarea></fieldset></div><input class="btn-photo" type="button" data-icon="star" data-iconpos="left" value="Adjuntar foto" /><img style="display:none;width:60px;height:60px;" id="smallImage" src="" /><div data-role="collapsible" class="partes-collapse"><h2>Consumio Partes</h2><ul class="lista-partes-modulo" data-role="listview" data-divider-theme="b" ></ul></div><input type="submit" data-transition="none" href="" class="btn-save-module" value="Guardar" />');a.find('div[data-role="fieldcontain"]').fieldcontain("refresh");$(".btn-save-module").button({create:function(b,c){}});$(".btn-photo").button({create:function(b,c){$(".btn-photo").click(function(d){getPhoto()})}});$(".textinput-time").textinput({create:function(b,c){}});$(".texarea-description").textinput({create:function(b,c){}});$(".checkbox-module").checkboxradio({create:function(b,c){$(this).bind("change",function(d,e){$.mobile.changePage($("#page19"),{transition:"none"})})}});$(".partes-collapse").collapsible({create:function(b,c){}})}function ParteModuloEquipoTicket(a){var f,e="",b=$("#page12 div[data-role='content'] div[data-role='collapsible-set'] form[data-idmoduleticket="+a+"]"),c="idUsuario",d="idReparacion";f=methods[14]+"&idModuloEquipoTicket="+a+"&idIngeniero="+sessionStorage.getItem(c)+"&"+d+"="+sessionStorage.getItem(d);b.find("ul.lista-partes-modulo").html("");$.getJSON(url,f,function(h){$.mobile.loading("hide");if(!h.hasOwnProperty("success")){if(h[0]===undefined){e+='<li data-theme="c" data-idparte="'+h.IDPARTEDETALLE+'" data-idsolicitud="'+h.IDSOLICITUDDETALLEREPARACION+'">'+h.ALIAS+'<input type="number" class="cantidad-devolver" value="0" name="CANTIDAD" data-mini="true" style="width: 20%;" />Disponible ['+h.CANTIDADENPODER+"] </li>"}else{for(var g in h){e+='<li data-theme="c" data-idparte="'+h[g].IDPARTEDETALLE+'" data-idsolicitud="'+h[g].IDSOLICITUDDETALLEREPARACION+'">'+h[g].ALIAS+'<input type="number" class="cantidad-devolver" value="0" name="CANTIDAD" data-mini="true" style="width: 20%;" />Disponible ['+h[g].CANTIDADENPODER+"] </li>"}}b.find("ul.lista-partes-modulo").html(e)}else{if(h.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}b.find(".cantidad-devolver").textinput({create:function(i,j){}});b.find(".lista-partes-modulo").listview({create:function(i,j){}});b.find(".lista-partes-modulo").listview("refresh");b.find('div[data-role="fieldcontain"]').fieldcontain("refresh")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function cerrarParteModuloDetalle(c){var a="",b,f,e=0,d=$("#page12 div[data-role='content'] div[data-role='collapsible-set'] form[data-idmoduleticket="+c+"]");$lista=d.find("ul.lista-partes-modulo li");$lista.each(function(){if($(this).data("role")!=="list-divider"){b=$(this).data("idparte");idSolicitud=$(this).data("idsolicitud");f="CANTIDAD_"+e+"="+$(this).find("input").val();a+="&IDMODULOEQUIPOTICKET_"+e+"="+c+"&IDPARTEDETALLE_"+e+"="+b+"&IDSOLICITUDDETALLEREPARACION_"+e+"="+idSolicitud+"&"+f;e++}});a=methods[15]+a;$.getJSON(url,a,function(g){if(!g.hasOwnProperty("success")){if(g.CIERREPARTESATISFACTORIO==="True"){}}else{if(g.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function agregarModulo(){$.mobile.loading("show");var c="idTicket",d="",b=$("#page12 .agregar-modulo-menu"),a;b.html("");a=methods[37]+"&"+c+"="+sessionStorage.getItem(c);$.getJSON(url,a,function(f){$("#btn-add-module").button("enable");$.mobile.loading("hide");b.append('<form action="" id="crear-modulo" autocomplete="off"><span>Seleccione modulo</span><select data-role="none" name="idModuloEquipo" id="lista-modulos-agregar"></select></form>');if(!f.hasOwnProperty("success")){if(f[0]===undefined){d+='<option class="modulo" value='+f.IDMODULOEQUIPO+">"+f.MODULO+"</option>"}else{for(var e in f){d+='<option class="modulo" value='+f[e].IDMODULOEQUIPO+">"+f[e].MODULO+"</option>"}}$("#lista-modulos-agregar").html(d);b.append('<p><fieldset data-role="controlgroup"><label for="description-modulo">Comentario</label><textarea name="" id="description-modulo" placeholder="nuevo"></textarea></fieldset></p><input type="button" value="aceptar" id="btn-agregar-modulo"/>')}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("#lista-modulos-agregar").selectmenu({create:function(g,h){}});$("#description-modulo").textinput({create:function(g,h){}});$("#btn-agregar-modulo").button({create:function(g,h){$(this).on("click",function(l){$(this).button("disable");$.mobile.loading("show");var i=$("#page12 #crear-modulo").serialize(),j="idTicket",k;k=$("#description-modulo").val();i=i+"&"+methods[38]+"&"+j+"="+sessionStorage.getItem(j)+"&strDescripcion="+k;$.getJSON(url,i,function(m){$("#btn-agregar-modulo").button("enable");$.mobile.loading("hide");if(!m.hasOwnProperty("success")){if(m.SATISFACTORIO==="True"){crearModulo($("#lista-modulos-agregar option:selected").val(),$("#lista-modulos-agregar option:selected").text())}else{alert("no se pudo crear el modulo")}}else{if(m.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("#page12 .agregar-modulo-menu").html("")})})}})}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function crearModulo(d,c){var b="idTicket",a=$("#page12 div[data-role='content'] div[data-role='collapsible-set']");a.append('<div data-role="collapsible" data-collapsed="false" class="module-collapse"><h3>Modulo: '+c+'</h3><div><p><b></b></p></div><form id="form-new-module" data-modulo="nuevo" data-idmoduleticket="'+d+'" data-ajax="false" autocomplete="off"></form></div>');$(".module-collapse").collapsible({create:function(e,f){}});$("div select.selectmenu1-new").selectmenu({create:function(e,f){}});a.find('div[data-role="fieldcontain"]').fieldcontain("refresh");loadoptions(true)}function checkList(){var d,c="",b="idReparacion",a=$("#page32 div[data-role='content']");d=methods[20]+"&"+b+"="+sessionStorage.getItem(b);a.html("");$.getJSON(url,d,function(f){a.append('<div class="titulo-reporte-servicio"><p><strong>Ticket#: '+sessionStorage.getItem("idTicket")+'</strong></p></div><form id="form-check-list" autocomplete="off"></form>');if(!f.hasOwnProperty("success")){$.mobile.loading("hide");for(var e in f){c+='<div data-role="fieldcontain"><fieldset data-role="controlgroup"><label for="toggleswitch'+f[e].IDPREGUNTA+'"">'+f[e].DESCRIPCION+'</label><select name="'+f[e].IDPREGUNTA+'" class="toggleswitch" id="toggleswitch'+f[e].IDPREGUNTA+'" data-theme="" data-role="slider"><option value="false">No</option><option value="true">Si</option></select></fieldset></div>'}a.find("form").html(c);a.find("form").append('<input data-role="button" data-transition="none" data-icon="check" data-iconpos="left" id="btn-send-check" value="Enviar" />')}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$(".toggleswitch").slider({create:function(g,h){}});$("#btn-send-check").button({create:function(g,h){$("#btn-send-check").on("click",function(l){item=0;$("#btn-send-check").button("disable");$.mobile.loading("show");l.preventDefault();var i,p=true,o,n=$(this).parents("form").serialize(),k="idReparacion",m="true",j=$("#page32 div[data-role='content']");o=n.split("&");sendChecklist(o,p)})}});a.find('div[data-role="fieldcontain"]').fieldcontain("refresh")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function sendChecklist(a,b){key="idReparacion";if(a.length>0){respuesta=a[0].split("=")[1];aux=methods[21]+"&"+key+"="+sessionStorage.getItem(key)+"&idPregunta="+(a[0].split("="))[0]+"&respuesta="+respuesta;$.ajax({url:url,data:aux,type:"GET",async:false,dataType:"json",success:function(c){if(!c.hasOwnProperty("success")){if(c.GUARDESATISFACTORIO==="True"){a.splice(0,1);sendChecklist(a,b)}else{b=false}if(!b){alert("No se ha enviado el check list");$("#btn-send-check").button("enable");$.mobile.loading("hide")}}else{if(c.success==="error"){alert("error de conexión");$("#btn-send-check").button("enable");$.mobile.loading("hide")}else{$("#btn-send-check").button("enable");$.mobile.loading("hide")}}}}).error(function(){alert("error de conexión");$("#btn-send-check").button("enable");$.mobile.loading("hide")})}else{if(b){alert("Se ha enviado el check list");$("#btn-send-check").button("enable");$.mobile.loading("hide");$.mobile.changePage($("#page9"),{transition:"none"})}}}function cerrarreparacionticket(g){g=g.replace(/%3A/gi,":");g=g.replace(/%40/gi,"@");g=g.replace(/\+/gi," ");g=g.replace(/%0D%0A/gi," ");var e="idReparacion",h=g.split("&");fechaActual=new Date();if((h[0].split("="))[1]==="true"){h[1]=(h[1].split("="))[0]+"="+fechaActual.getFullYear()+"-"+(fechaActual.getMonth()+1)+"-"+fechaActual.getDate();h[2]=(h[2].split("="))[0]+"="+fechaActual.getHours()+":"+fechaActual.getMinutes();h[1]+=" "+(h[2].split("="))[1];if((h[4].split("="))[1]==="hora"){h.splice(2,4)}else{h.splice(2,3)}}else{var b="fecha=";if((h[3].split("="))[1]==="hora"){b+=fechaActual.getFullYear()+"-"+(h[1].split("="))[1]+"-"+(h[2].split("="))[1];h.splice(2,2)}else{b+=(h[3].split("="))[1]+"-"+(h[1].split("="))[1]+"-"+(h[2].split("="))[1];h[1]=b;h[1]+=" "+(h[4].split("="))[1];h.splice(2,3)}}g=h[0];for(var d=1;d<h.length;d++){g+="&"+h[d]}var a=document.getElementById("signaturePanel");var f=a.toDataURL();var c=f.replace(/^data:image\/(png|jpg);base64,/,"");g=methods[13]+"&firma="+c+"&"+e+"="+sessionStorage.getItem(e)+"&"+g;$.ajax({url:url1,type:"POST",crossDomain:true,data:g,dataType:"text json",success:function(i){if(!i.hasOwnProperty("success")){$.mobile.loading("hide");if(i.CIERRESATISFACTORIO==="True"){alert("El servicio ha sido cerrado");reloadMenuOption();$("#page28 content-canvas").html("")}else{alert("El servicio no ha sido cerrado")}$.mobile.loading("hide");$("#btn-send-close").button("enable")}else{if(i.success==="error"){$("#btn-send-close").button("enable");alert("error de conexión");$.mobile.loading("hide")}else{$("#btn-send-close").button("enable");$.mobile.loading("hide")}}}}).error(function(){$("#btn-send-close").button("enable");alert("error de conexión");$.mobile.loading("hide")})}function preview(f){f=decodeURIComponent(f);f=f.replace(/Contacto/gi,"");f=f.replace(/\+/gi," ");var c=$("#page28 div[data-role='content'] #idpreview"),g=f.split("&"),b=new Date();if((g[0].split("="))[1]==="true"){g[1]=(g[1].split("="))[0]+"="+b.getFullYear()+"-"+(b.getMonth()+1)+"-"+b.getDate();g[2]=(g[2].split("="))[0]+"="+b.getHours()+":"+b.getMinutes();g[1]+=" "+(g[2].split("="))[1];if((g[3].split("="))[1]==="hora"){g.splice(2,2)}else{g.splice(2,3)}}else{var a="fecha=";if((g[3].split("="))[1]==="hora"){a+=b.getFullYear()+"-"+(g[1].split("="))[1]+"-"+(g[2].split("="))[1];g.splice(2,2)}else{a+=(g[3].split("="))[1]+"-"+(g[1].split("="))[1]+"-"+(g[2].split("="))[1];g[1]=a;g[1]+=" "+(g[4].split("="))[1];g.splice(2,3)}}var d="idReparacion",e=methods[4]+"&"+d+"="+sessionStorage.getItem(d),h;h=sessionStorage.getItem("modulo");h=JSON.parse(h);$.getJSON(url,e,function(k){if(!k.hasOwnProperty("success")){g[1]+=" "+(g[2].split("="))[1];c.html("");c.append(" <p><strong>Número de servicio </strong><br>"+k.IDTICKET+"</p><p><strong>Datos del equipo <br>Equipo:</strong> "+k.LUNO+" <strong>Serial:</strong> "+k.SERIAL+"</strong><br/><strong>Cliente:</strong> "+k.CLIENTE+"</p><p><strong>Tareas</strong><br>");for(var i in h){c.append("<p><strong>Modulo:</strong> "+h[i].nombre+"<br/><strong>Problema:</strong> "+h[i].problema+"<br/><strong>Causal:</strong> "+h[i].causal+"<br/><strong>Cierre</strong>: "+h[i].cierre+"<br/><strong>Reparación:</strong> "+h[i].reparacion+"<br/><strong>Comentario:</strong> "+h[i].descripcion+"<br/><p/>")}correo="";tele="";comentario="";if((g[8].split("="))[1]){correo=(g[8].split("="))[1]}if((g[9].split("="))[1]){tele=(g[9].split("="))[1]}if((g[10].split("="))[1]){comentario=(g[10].split("="))[1]}c.append("</p><p><strong>Datos de la persona de contacto</strong> <br><strong>Nombre:</strong> "+(g[7].split("="))[1]+"<br><strong>Correo:</strong> "+correo+"<br><strong>Telefóno:</strong> "+tele+"<br><strong>Comentario:</strong> "+comentario+"<br></p><p><strong>Fecha y Hora de Apertura</strong> <br>"+k.FECHAAPERTURA+"</p><p><strong>Fecha y Hora de cierre</strong> <br>"+(g[1].split("="))[1]+"</p>")}else{if(k.success==="error"){$("#btn-preview").button("enable");alert("error de conexión");$.mobile.loading("hide")}else{$("#btn-preview").button("enable");$.mobile.loading("hide")}}$("#btn-preview").button("enable");$.mobile.loading("hide");$.mobile.changePage($("#page28"),{transition:"none"})}).error(function(){$("#btn-preview").button("enable");alert("error de conexión");$.mobile.loading("hide")})}function novedadesTicket(){$("#page15 div").remove(".ui-select");$("#page15 .select-novedad").append('<select data-role="none" name="IDCODIGONOVEDADCONFIGURACION" id="novedad-ticket" class="novedades-ticket"></select>');$(".novedades-ticket").selectmenu({create:function(e,f){}});$("#form-novedades-ticket").data("novedad","2");var d,c="",a=$("#page15 #novedad-ticket"),b="idTicket";d=methods[22]+"&"+b+"="+sessionStorage.getItem(b);a.html("");$.getJSON(url,d,function(f){$.mobile.loading("hide");$("#btn-send-novedad").button("disable");if(!f.hasOwnProperty("success")){if(f[0]===undefined){c+='<option value="'+f.IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+f.VALORADICIONALPREGUNTA+'">'+f.DESCRIPCION+"</option>"}for(var e in f){c+='<option value="'+f[e].IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+f[e].VALORADICIONALPREGUNTA+'">'+f[e].DESCRIPCION+"</option>"}a.html(c);a.selectmenu("refresh",true);a.val(0)}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function statusXMS(){var c="",b="idReparacion",a=$("#page21 div[data-role='content']"),d=methods[16]+"&"+b+"="+sessionStorage.getItem(b),e=methods[17]+"&"+b+"="+sessionStorage.getItem(b);a.find(".encabezado").html("");a.find("#collapsible-xms").html("");$.getJSON(url,d,function(f){if(!f.hasOwnProperty("success")){a.find(".encabezado").append("<p><strong>ATM "+f.strLuno+"</strong></p><p><strong>Estado:"+f.EQUIPMENTSTATUS+"</strong></p>");$.getJSON(url,e,function(j){$.mobile.loading("hide");if(!f.hasOwnProperty("success")){if(j.MODULO[0]===undefined){a.find("#collapsible-xms").append('<div data-role="collapsible" class="collapse-modulos"><h2>'+j.MODULO.NOMBRE+": "+j.MODULO.STATUS+'</h2><ul data-role="listview" data-divider-theme="b" id="lista-xms'+h+'" class="list-status"></ul></div>');if(j.MODULO.SUBMODULOS.SUBMODULO[0]===undefined){c+='<li data-theme="c">'+j.MODULO.SUBMODULOS.SUBMODULO.NOMBRE+": "+j.MODULO.SUBMODULOS.SUBMODULO.STATUS+"</li>"}else{for(var i in j.MODULO.SUBMODULOS.SUBMODULO){c+='<li data-theme="c">'+j.MODULO[h].SUBMODULOS.SUBMODULO.NOMBRE+": "+j.MODULO.SUBMODULOS.SUBMODULO[i].STATUS+"</li>"}}a.find("#lista-xms"+h).append(c);c=""}else{for(var h in j.MODULO){a.find("#collapsible-xms").append('<div data-role="collapsible" class="collapse-modulos"><h2>'+j.MODULO[h].NOMBRE+": "+j.MODULO[h].STATUS+'</h2><ul data-role="listview" data-divider-theme="b" id="lista-xms'+h+'" class="list-status"></ul></div>');if(j.MODULO[h].SUBMODULOS.SUBMODULO[0]===undefined){c+='<li data-theme="c">'+j.MODULO[h].SUBMODULOS.SUBMODULO.NOMBRE+": "+j.MODULO[h].SUBMODULOS.SUBMODULO.STATUS+"</li>"}else{for(var g in j.MODULO[h].SUBMODULOS.SUBMODULO){c+='<li data-theme="c">'+j.MODULO[h].SUBMODULOS.SUBMODULO[g].NOMBRE+": "+j.MODULO[h].SUBMODULOS.SUBMODULO[g].STATUS+"</li>"}}a.find("#lista-xms"+h).append(c);c=""}}$(".collapse-modulos").collapsible({create:function(k,l){}});$(".list-status").listview({create:function(k,l){}});$(".list-status").listview("refresh")}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}})}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$(".collapsible-xms").collapsibleset("refresh");$("#page21 div[data-role='content']").fieldcontain("refresh")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function seguimientoActividades(){var c="",b="idTicket",a=$("#page22 div[data-role='content'] #list-actividades"),d=methods[39]+"&"+b+"="+sessionStorage.getItem(b);a.html("");a.append('<li data-role="list-divider" role="heading">Actividades</li>');$.getJSON(url,d,function(f){if(!$.isEmptyObject(f)){if(!f.hasOwnProperty("success")){var h="0",g;if(f.ACTIVIDADRELACIONADA[0]===undefined){h=f.ACTIVIDADRELACIONADA.IDSOLICITUD;if(h==="0"){h=f.ACTIVIDADRELACIONADA.IDCOORDINACIONDETALLE}if(f.ACTIVIDADRELACIONADA.SEMAFORO==="1"){g="verde.png"}else{if(f.ACTIVIDADRELACIONADA.SEMAFORO==="2"){g="amarillo.png"}else{g="rojo.png"}}c+='<li data-theme="c" ><img src="img/'+g+'" style="margin-top:5%; margin-left:1%"/>'+f.ACTIVIDADRELACIONADA.ACTIVIDAD+" "+h+'<span class="ui-li-count"> '+f.ACTIVIDADRELACIONADA.ESTADO+"</span></li>"}else{for(var e in f.ACTIVIDADRELACIONADA){h=f.ACTIVIDADRELACIONADA[e].IDSOLICITUD;if(h==="0"){h=f.ACTIVIDADRELACIONADA[e].IDCOORDINACIONDETALLE}if(f.ACTIVIDADRELACIONADA[e].SEMAFORO==="1"){g="verde.png"}else{if(f.ACTIVIDADRELACIONADA[e].SEMAFORO==="2"){g="amarillo.png"}else{g="rojo.png"}}c+='<li data-theme="c" ><img src="img/'+g+'" style="margin-top:5%; margin-left:1%"/>'+f.ACTIVIDADRELACIONADA[e].ACTIVIDAD+" "+h+'<span class="ui-li-count"> '+f.ACTIVIDADRELACIONADA[e].ESTADO+"</span></li>"}}}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}a.append(c)}else{c+='<li data-theme="c" ><span"> No tiene actividades relacionadas</span></li>';a.append(c)}$("#list-actividades").listview("refresh");$("#list-actividades").listview({create:function(i,j){}});$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function detalleActividades(d,a){var b=$("#page23 div[data-role='content']"),c=methods[40]+"&idSolicitud="+d+"&idCoordinacionDetalle="+a;b.html("");$.getJSON(url,c,function(e){if(!e.hasOwnProperty("success")){b.append("<div><p><b>Servicio</b>12347</p><p><b>Tarea:</b>"+e.ACTIVIDAD+"</p><p><b>Fecha y hora Solicitud:</b>"+e.FECHAINICIO+"</p><p><b>Usuario que solicito:</b>Ninguna</p><p><b>Fecha cambio de estado:</b>"+e.FECHAFIN+"</p><p><b>Usuario que modifico:&nbsp;</b></p></div>")}else{if(e.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function searchPartes(f){$.mobile.loading("show");$("#btn-search-partes").button("disable");var c="idReparacion",d="",a="",b=$("#page16 #list-search-partes"),e=$("#page19 div[data-role='content'] ul");f=methods[24]+"&"+c+"="+sessionStorage.getItem(c)+"&"+f;$.getJSON(url,f,function(h){b.html("");e.html("");d+='<li data-role="list-divider" role="heading">Resultado</li>';a+='<li data-role="list-divider" role="heading">Resultado</li>';if(!h.hasOwnProperty("success")){for(var g in h){d+='<li data-theme="c" ><a href="" data-transition="none" id="parte'+g+'" data-cargado="no" data-idpartedetalle="'+h[g].IDPARTEDETALLE+'"><span>'+h[g].ALIAS+"</span><br><p><br>"+h[g].PARTE+"</p></a></li>";a+='<li data-theme="c" ><a href="" data-transition="none" id="parte'+g+'"><span>'+h[g].ALIAS+"</span><br><p><br>"+h[g].PARTE+"</p></a></li>"}}else{if(h.success==="error"){alert("error de conexión");$.mobile.loading("hide");d+='<li data-theme="c">No se encuentra la parte solicitada</li>'}else{d+='<li data-theme="c">No se encuentra la parte solicitada</li>'}}b.html(d);e.html(a);$("#list-search-partes a").on("click",function(i){if($(this).data("cargado")==="no"){$(this).css("background","rgba(0, 0, 0, 0.1)");$(this).css("color","#459CD6");carritoPartes($(this));$(this).data("cargado","si");$("#list-search-partes").listview("refresh")}});$("#list-search-partes").listview({create:function(i,j){}});b.listview("refresh");$.mobile.loading("hide");$("#btn-search-partes").button("enable")}).error(function(){alert("error de conexión");$.mobile.loading("hide");$("#btn-search-partes").button("enable")})}function carritoPartes(f){var c=$("#page16 #lista-solicitar-partes"),a=f.data("idpartedetalle"),d=f.find("span").text(),b=f.find("p").text(),e=f.attr("id");c.append('<li data-theme="c" data-idParteDetalle="'+a+'" data-icon="delete" data-modulo="'+e+'"><a><span>'+d+".</span><br><p><br>"+b+'</p><span style="float:left;">Cantidad </span><input type="number" class="cantidad-solicitar" name="CANTIDAD" data-mini="true" style="width: 20%; float:left; margin:0 20px;" /></a><a class="descartar-parte" data-mini="true" data-icon="delete" data-inline="true" data-theme="c" ></a></li>');c.listview("refresh");$(".descartar-parte").button({create:function(g,h){}});c.find(".cantidad-solicitar").textinput({create:function(g,h){}});$(".descartar-parte").live("click",function(g){$li=$(this).closest("li");$('#list-search-partes a[data-idpartedetalle="'+$li.data("idpartedetalle")+'"]').data("cargado","no");parte=$(this).closest("li").data("modulo");$("#list-search-partes #"+parte).css("background","");$("#list-search-partes #"+parte).css("color","");$(this).closest("li").remove()})}function solicitarParte(){var d="idReparacion",e="",c=0,a=sessionStorage.getItem(d),b=$("#page16 div[data-role='content'] #lista-solicitar-partes li");b.each(function(){if($(this).data("role")!=="list-divider"){if($(this).find("input").val()>0){cantidad="&CANTIDAD_"+c+"="+$(this).find("input").val();e+=cantidad+"&IDREPARACION_"+c+"="+a+"&IDPARTEDETALLE_"+c+"="+$(this).data("idpartedetalle");c++}}});e=methods[33]+e;$.getJSON(url,e,function(f){$.mobile.loading("hide");if(!f.hasOwnProperty("success")){if(f.SOLICITUDSATISFACTORIA==="True"){alert("Se ha enviado solicitud de parte");limpiaSearch();$.mobile.changePage($("#page5"),{transition:"none"})}else{alert("No se envio solicitud de parte")}$("#solicitar-partes").button("enable")}else{if(f.success==="error"){alert("error de conexión");$.mobile.loading("hide");$("#solicitar-partes").button("enable")}else{$.mobile.loading("hide");$("#solicitar-partes").button("enable")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide");$("#solicitar-partes").button("enable")})}function listarPartesSolicitadas(){var b="idReparacion",a=$("#page41 div[data-role='content'] #partes-solicitadas");formData=methods[41]+"&"+b+"="+sessionStorage.getItem(b);a.html("");$.getJSON(url,formData,function(o){if(typeof(o)==="object"&&!o.hasOwnProperty("SOLICITUD")){a.append("<span>No tiene partes solicitadas</span>");$.mobile.loading("hide")}else{if(!o.hasOwnProperty("success")){var d,c;if(o.SOLICITUD[0]===undefined){a.append('<div data-role="collapsible" class="collapse-partes" id="'+o.SOLICITUD.IDSOLICITUD+'" data-accion=""><h3>Solicitud '+o.SOLICITUD.IDSOLICITUD+'</h3><ul data-role="listview" data-divider-theme="b" data-inset="true" class="lista-partes-solicitadas" data-idsolicitud="'+o.SOLICITUD.IDSOLICITUD+'" data-accion="0"><li data-accionrole="list-divider" role="heading">Partes</li></ul><input data-transition="none" type="button" class="btn-partes" value="enviar"></div>');a.find("div.collapse-partes .btn-partes").button({create:function(i,j){}});if(o.SOLICITUD.PARTEDETALLE[0]===undefined){d="procesado";c=3;if(o.SOLICITUD.PUEDEELIMINAR==="True"){d="eliminar"}if(o.SOLICITUD.PUEDECONSUMIR==="True"){d="recibir";c=1}else{if(o.SOLICITUD.PARTEDETALLE.DEVOLVER==="True"){d="devolver";c=0}}a.find('ul[data-idsolicitud="'+o.SOLICITUD.IDSOLICITUD+'"]').append('<li data-idsolicituddr="'+o.SOLICITUD.PARTEDETALLE.IDSOLICITUDDETALLEREPARACION+'" data-accion="'+c+'"><a><span>'+o.SOLICITUD.PARTEDETALLE.ALIAS+"</span><br><p><br>"+o.SOLICITUD.PARTEDETALLE.CANTIDADPEDIDA+" "+d+'</p></a><input min="0" max="'+o.SOLICITUD.PARTEDETALLE.CANTIDADPEDIDA+'" type="number" class="cantidad-partes" name="CANTIDAD" data-mini="true" style="width: 20%; margin-left: 10px;" /><select data-role="none" name="IDCODIGONOVEDADCONFIGURACION" class="novedades-almacen" data-mini="true" data-novedad="" ></select><a class="eliminar-parte" data-mini="true" data-icon="delete" data-inline="true" data-theme="c" style="display:none;"></a></li>')}else{for(var f in o.SOLICITUD.PARTEDETALLE){d="procesado";c=3;if(o.SOLICITUD.PUEDEELIMINAR==="True"){d="eliminar"}if(o.SOLICITUD.PUEDECONSUMIR==="True"){d="recibir";c=1}else{if(o.SOLICITUD.PARTEDETALLE[f].DEVOLVER==="True"){d="devolver";c=0}}a.find('ul[data-idsolicitud="'+o.SOLICITUD.IDSOLICITUD+'"]').append('<li data-idsolicituddr="'+o.SOLICITUD.PARTEDETALLE[f].IDSOLICITUDDETALLEREPARACION+'" data-accion="'+c+'"><a><span>'+o.SOLICITUD.PARTEDETALLE[f].ALIAS+"</span><br><p><br>"+o.SOLICITUD.PARTEDETALLE[f].CANTIDADPEDIDA+" "+d+'</p></a><input min="0" max="'+o.SOLICITUD.PARTEDETALLE[f].CANTIDADPEDIDA+'" type="number" class="cantidad-partes" name="CANTIDAD" data-mini="true" style="width: 20%; margin-left: 10px;" /><select data-role="none" name="IDCODIGONOVEDADCONFIGURACION" class="novedades-almacen" data-mini="true" data-novedad="" ></select><a class="eliminar-parte" data-mini="true" data-icon="delete" data-inline="true" data-theme="c" style="display:none;"></a></li>')}}a.find("#"+o.SOLICITUD.IDSOLICITUD).append('<div data-role="fieldcontain"><form id="form-novedades-partes" autocomplete="off"><select data-role="none" name="IDCODIGONOVEDADCONFIGURACION" class="novedades-almacen-general" data-novedad=""></select><p><div data-role="fieldcontain"><fieldset data-role="controlgroup"><label for="comentario-partes">Comentario</label><textarea name="PREGUNTA" class="comentario-partes text-novedades" placeholder=""></textarea></fieldset></div></p><div data-role="fieldcontain" class="div-adicional-almacen"><fieldset data-role="controlgroup"><label for="valor-adicional-almacen">Pregunta</label><textarea name="VALORADICIONALPREGUNTA" id="valor-adicional-almacen" class="text-novedades""></textarea></fieldset></div></form><input data-role="button" data-transition="node" class="btn-novedad-partes" value="novedad solicitud" /></div>');$(".cantidad-partes").hide();$(".novedades-almacen").closest("div.ui-select").hide();if(o.SOLICITUD.PUEDECONSUMIR==="True"){$(".cantidad-partes").show()}else{$(".btn-partes").button("disable")}if(o.SOLICITUD.PUEDEELIMINAR==="True"){$(".btn-partes").button("disable");$(".eliminar-parte").show();$(".novedades-almacen").closest("div.ui-select").hide()}}else{for(var g in o.SOLICITUD){a.append('<div data-role="collapsible" class="collapse-partes" id="'+o.SOLICITUD[g].IDSOLICITUD+'" data-accion=""><h3>Solicitud '+o.SOLICITUD[g].IDSOLICITUD+'</h3><ul data-role="listview" data-divider-theme="b" data-inset="true" class="lista-partes-solicitadas" data-idsolicitud="'+o.SOLICITUD[g].IDSOLICITUD+'" data-accion="0"><li data-role="list-divider" role="heading">Partes</li></ul><input data-transition="none" type="button" class="btn-partes" value="enviar"></div>');$div_main=a.find("div#"+o.SOLICITUD[g].IDSOLICITUD);$div_main.find(".btn-partes").button({create:function(i,j){}});console.log($div_main);if(o.SOLICITUD[g].PARTEDETALLE[0]===undefined){d="procesado";c=3;if(o.SOLICITUD[g].PUEDEELIMINAR==="True"){d="eliminar"}if(o.SOLICITUD[g].PUEDECONSUMIR==="True"){d="recibir";c=1;$div_main.data("accion","1")}else{if(o.SOLICITUD[g].PARTEDETALLE.DEVOLVER==="True"){d="devolver";c=0;$div_main.data("accion","1")}}a.find('ul[data-idsolicitud="'+o.SOLICITUD[g].IDSOLICITUD+'"]').append('<li data-idsolicituddr="'+o.SOLICITUD[g].PARTEDETALLE.IDSOLICITUDDETALLEREPARACION+'" data-accion="'+c+'"><a><span>'+o.SOLICITUD[g].PARTEDETALLE.ALIAS+"</span><br><p><br>"+o.SOLICITUD[g].PARTEDETALLE.CANTIDADPEDIDA+" "+d+'</p></a><input min="0" max="'+o.SOLICITUD[g].PARTEDETALLE.CANTIDADPEDIDA+'" type="number" class="cantidad-partes" name="CANTIDAD" data-mini="true" style="width: 20%; margin-left: 10px;" /><select data-theme="b" data-role="none" name="IDCODIGONOVEDADCONFIGURACION" class="novedades-almacen" data-mini="true" data-novedad="" ></select><a class="eliminar-parte" data-mini="true" data-icon="delete" data-inline="true" data-theme="c" style="display:none;"></a></li>')}else{for(var e in o.SOLICITUD[g].PARTEDETALLE){d="procesado";c=3;if(o.SOLICITUD[g].PUEDEELIMINAR==="True"){d="eliminar"}if(o.SOLICITUD[g].PUEDECONSUMIR==="True"){d="recibir";c=1;$div_main.data("accion","1")}else{if(o.SOLICITUD[g].PARTEDETALLE[e].DEVOLVER==="True"){d="devolver";c=0;$div_main.data("accion","1")}}a.find('ul[data-idsolicitud="'+o.SOLICITUD[g].IDSOLICITUD+'"]').append('<li data-idsolicituddr="'+o.SOLICITUD[g].PARTEDETALLE[e].IDSOLICITUDDETALLEREPARACION+'" data-accion="'+c+'"><a><span>'+o.SOLICITUD[g].PARTEDETALLE[e].ALIAS+"</span><br /><p><br>"+o.SOLICITUD[g].PARTEDETALLE[e].CANTIDADPEDIDA+" "+d+'</p></a><input  min="0" max="'+o.SOLICITUD[g].PARTEDETALLE[e].CANTIDADPEDIDA+'" type="number" class="cantidad-partes" name="CANTIDAD" data-mini="true" style="width: 20%; margin-left: 10px;" /><select data-theme="b" data-role="none" name="IDCODIGONOVEDADCONFIGURACION" class="novedades-almacen" data-mini="true" data-novedad="" ></select><a class="eliminar-parte" data-mini="true" data-icon="delete" data-inline="true" data-theme="c" style="display:none;"></a></li>')}}$div_main.append('<div data-role="fieldcontain"><form id="form-novedades-partes" autocomplete="off"><select data-theme="b" data-role="none" name="IDCODIGONOVEDADCONFIGURACION" class="novedades-almacen-general" data-novedad=""></select><p><div data-role="fieldcontain"><fieldset data-role="controlgroup"><label for="comentario-partes">Comentario</label><textarea name="PREGUNTA" class="comentario-partes text-novedades" placeholder=""></textarea></fieldset></div></p><div data-role="fieldcontain" class="div-adicional-almacen"><fieldset data-role="controlgroup"><label for="valor-adicional-almacen">Pregunta</label><textarea name="VALORADICIONALPREGUNTA" id="valor-adicional-almacen" class="text-novedades"></textarea></fieldset></div></form><input data-role="button" data-transition="node" class="btn-novedad-partes" value="novedad solicitud" /></div>');$div_main.find(".cantidad-partes").hide();$div_main.find(".novedades-almacen").closest("div.ui-select").hide();if(o.SOLICITUD[g].PUEDECONSUMIR==="True"){$div_main.find(".cantidad-partes").show()}else{$div_main.find(".btn-partes").button("disable")}if(o.SOLICITUD[g].PUEDEELIMINAR==="True"){$div_main.find(".btn-partes").button("disable");$div_main.find(".eliminar-parte").show();$div_main.find(".novedades-almacen").closest("div.ui-select").hide()}console.log($div_main.data("accion"));if($div_main.data("accion")==="1"){$div_main.find(".btn-partes").button("enable")}}}$(".div-adicional-almacen").hide();var h,l="",n="",m="idTicket";h=methods[47]+"&"+m+"="+sessionStorage.getItem(m);$.getJSON(url,h,function(j){if(!$.isEmptyObject(j)){if(!j.hasOwnProperty("success")){if(j.NOVEDAD[0]===undefined){l+='<option value="'+j.NOVEDAD.IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+j.NOVEDAD.VALORADICIONALPREGUNTA+'">'+j.NOVEDAD.DESCRIPCION+"</option>";a.find(".novedades-almacen-general").append(l);$(".novedades-almacen-general").selectmenu({create:function(k,p){}})}else{for(var i in j.NOVEDAD){l+='<option value="'+j.NOVEDAD[i].IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+j.NOVEDAD[i].VALORADICIONALPREGUNTA+'">'+j.NOVEDAD[i].DESCRIPCION+"</option>"}a.find(".novedades-almacen-general").append(l);$(".novedades-almacen-general").selectmenu({create:function(k,p){}})}}else{if(o.success==="error"){alert("error de conexión");$.mobile.loading("hide");$(".novedades-almacen-general").selectmenu({create:function(k,p){}})}else{$.mobile.loading("hide");$(".novedades-almacen-general").selectmenu({create:function(k,p){}})}}}else{alert("error de conexión");$.mobile.loading("hide");$(".novedades-almacen-general").selectmenu({create:function(k,p){}})}});h=methods[31]+"&"+m+"="+sessionStorage.getItem(m);$.getJSON(url,h,function(j){if(!$.isEmptyObject(j)){if(!j.hasOwnProperty("success")){if(j.NOVEDAD[0]===undefined){n+='<option value="'+j.NOVEDAD.IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+j.NOVEDAD.VALORADICIONALPREGUNTA+'">'+j.NOVEDAD.DESCRIPCION+"</option>";a.find(".novedades-almacen").append(n);$(".novedades-almacen").selectmenu({create:function(k,p){$(".novedades-almacen").closest("div.ui-select").each(function(){$(this).css("width","50%");$(this).hide()})}})}else{for(var i in j.NOVEDAD){n+='<option value="'+j.NOVEDAD[i].IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+j.NOVEDAD[i].VALORADICIONALPREGUNTA+'">'+j.NOVEDAD[i].DESCRIPCION+"</option>"}a.find(".novedades-almacen").append(n);$(".novedades-almacen").selectmenu({create:function(k,p){$(".novedades-almacen").closest("div.ui-select").each(function(){$(this).css("width","50%");$(this).hide()})}})}}else{if(o.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}else{alert("error de conexión");$.mobile.loading("hide")}});$(".cantidad-partes").textinput({create:function(i,j){$(this).focusout(function(){if($(this).val()>$(this).attr("max")){$(this).val($(this).attr("max"))}if($(this).val()<$(this).attr("max")){$(this).closest("li").find("div.ui-select").show()}else{$(this).closest("li").find("div.ui-select").hide()}})}});$("#valor-adicional-almacen").textinput({create:function(i,j){}});$(".comentario-partes").textinput({create:function(i,j){}});$(".btn-novedad-partes").button({create:function(i,j){$(this).button("disable")}});$(".collapse-partes").collapsible({create:function(i,j){}});$(".lista-partes-solicitadas").listview({create:function(i,j){}});$("#page41 .btn-novedad-partes").click(function(){$.mobile.loading("show");var i=$(this).closest('div[data-role="collapsible"]'),j=i.find("#form-novedades-partes").serialize();if(i.find("form .novedades-almacen-general option:selected").val()>"0"){$(this).button("disable");registroNovedad(j,i.attr("id"))}else{$.mobile.loading("hide")}});$(".btn-partes").on("click",function(i){$.mobile.loading("show");$(this).button("disable");$ul=$(this).closest('div[data-role="collapsible"]').find("ul.lista-partes-solicitadas");$listaRecibe=$ul.find('li[data-accion="'+1+'"]');$listaDevuelve=$ul.find('li[data-accion="'+0+'"]');if($listaRecibe.length>0){recibePartes($listaRecibe)}if($listaDevuelve.length>0){devuelvePartes($listaDevuelve)}if($ul.find("li").length!==($listaDevuelve.length+$listaRecibe.length+1)){$.mobile.loading("hide");$(this).button("enable")}});$(".eliminar-parte").on("click",function(j){$liactual=$(this).closest("li");var k=$liactual.data("idsolicituddr"),i="idUsuario";h=methods[48]+"&idSolicitudDetalleReparacion="+k+"&"+i+"="+sessionStorage.getItem(i);$.getJSON(url,h,function(p){if(!p.hasOwnProperty("success")){if(p.ELIMINACIONSATISFACTORIA==="True"){$liactual.remove()}else{alert("no se elimino la parte")}}else{if(p.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}})});$.mobile.loading("hide")}else{if(o.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function devuelvePartes(b){var c=methods[32],a=0;b.each(function(){idSolicitud=$(this).data("idsolicituddr");cantidad=$(this).find("input").val();c+="&IDSOLICITUDDETALLEREPARACION_"+a+"="+idSolicitud+"&CANTIDAD_"+a+"="+cantidad;a++});$.getJSON(url,c,function(d){$.mobile.loading("hide");if(!d.hasOwnProperty("success")){if(d.RECEPCIONSATISFACTORIA==="True"){alert("Se ha enviado devolver partes");$.mobile.changePage($("#page5"),{transition:"none"})}else{alert("NO se pudo enviar devolución")}}else{if(d.success==="error"){alert("error de conexión");$.mobile.loading("hide");$(".btn-partes").button("enable")}else{$.mobile.loading("hide");$(".btn-partes").button("enable")}}$(".btn-partes").button("enable")}).error(function(){alert("error de conexión");$.mobile.loading("hide");$(".btn-partes").button("enable")})}function recibePartes(b){var c=methods[34],a=0;b.each(function(){idSolicitud=$(this).data("idsolicituddr");cantidad=$(this).find("input").val();idconfiguracion=$(".novedades-almacen").find(":selected").val();c+="&IDSOLICITUDDETALLEREPARACION_"+a+"="+idSolicitud+"&CANTIDAD_"+a+"="+cantidad+"&IDCODIGONOVEDADCONFIGURACION_"+a+"="+idconfiguracion;a++});$.getJSON(url,c,function(d){$.mobile.loading("hide");if(!d.hasOwnProperty("success")){if(d.RECEPCIONSATISFACTORIA==="True"){alert("Se ha enviado recibir partes");$.mobile.changePage($("#page5"),{transition:"none"})}else{alert("NO se pudo enviar recibir partes")}}else{if(d.success==="error"){alert("error de conexión");$.mobile.loading("hide");$(".btn-partes").button("enable")}else{$.mobile.loading("hide");$(".btn-partes").button("enable")}}$(".btn-partes").button("enable")}).error(function(){alert("error de conexión");$.mobile.loading("hide");$(".btn-partes").button("enable")})}function detallesPartes(d,a){var c="idReparacion",b=$("#page36 div[data-role='content'] #detalle-parte");d=methods[24]+"&"+c+"="+sessionStorage.getItem(c)+"&"+d;b.html("");$.getJSON(url,d,function(e){if(!e.hasOwnProperty("success")){b.append("<h3>Alias: "+e[a].ALIAS+"</h3><div><p><b>Parte: </b>"+e[a].PARTE+"</p><p><b>Disponible: </b>"+e[a].DISPONIBLE+"</p><p><b>Solicitadas: </b>"+e[a].SOLICITADA+"</p><p><b>Recibidas: </b>recibdas</p><p><b>Pendientes por recibir: </b>pendientes</p><p><b>Pendientes Por devolver: </b>pendientes devolver</p><p><b>Devueltas: </b>devueltas</p><p><b>Estado: </b>estado</p></div>");$("#solicita-parte").data("idParteDetalle",e[a].IDPARTEDETALLE);$("#recibe-parte").data("idParteDetalleReparacion",e[a].IDPARTEDETALLEREPARACION)}else{if(e.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")});$.mobile.changePage($("#page36"),{transition:"none"})}function listarNovedades(){var e,c="idUsuario",d="idReparacion",a=$("#page42 #msn-generados"),b=$("#page42 #msn-recibidos");e=methods[42]+"&idUsuarioConsulta="+sessionStorage.getItem(c)+"&"+d+"="+sessionStorage.getItem(d);a.html("");a.append('<li data-role="list-divider" role="heading">Mensajes generados</li>');b.html("");b.append('<li data-role="list-divider" role="heading">Mensajes recibidos</li>');$(".msn-novedades").listview("refresh");$.getJSON(url,e,function(g){if(!g.hasOwnProperty("success")){ticket=sessionStorage.getItem("idTicket");for(var f in g){if(g[f].GENERADO==="False"){b.append('<li data-theme="c"><a href="" data-transition="none" class="msn-detalle-novedad" data-pantalla="#'+g[f].NAVEGACIONMOVILIDAD+'" data-idcodigo="'+g[f].IDCODIGONOVEDADCONFIGURACIONREPARACIONDETALLE+'" data-idticket="'+ticket+'" data-tipo="recibido">'+g[f].NOVEDADDESCRIPCION+"</a></li>")}else{a.append('<li data-theme="c"><a href="" data-transition="none" class="msn-detalle-novedad" data-pantalla="#'+g[f].NAVEGACIONMOVILIDAD+'" data-idcodigo="'+g[f].IDCODIGONOVEDADCONFIGURACIONREPARACIONDETALLE+'" data-idticket="'+ticket+'" data-tipo="generado">'+g[f].NOVEDADDESCRIPCION+"</a></li>")}}}else{if(g.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$('#page43 div[data-role="header"] a[data-icon="back"]').attr("href","#page42");$(".msn-novedades").listview("refresh");$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function obtenerNovedad(f,c){var e,d="",g="",a="",b=$("#page43 #detalle-msn-novedad");e=methods[30]+"&idCodigoNovedadConfiguracionReparacionDetalle="+f;b.html("");$.getJSON(url,e,function(h){if(!h.hasOwnProperty("success")){d=h.NOVEDADMENSAJE.RESPUESTA;g=h.NOVEDADMENSAJE.PREGUNTA;fechap=h.NOVEDADMENSAJE.FECHAPREGUNTA;fechar=h.NOVEDADMENSAJE.FECHARESPUESTA;codigorespu=h.NOVEDADMENSAJE.IDCODIGONOVEDADRESPUESTA;codigoconfi=h.NOVEDADMENSAJE.IDCODIGONOVEDADCONFIGURACIONREPARACIONDETALLE;if(typeof(d)==="object"){d=""}if(typeof(g)==="object"){g=""}if(typeof(fechap)==="object"){fechap=""}if(typeof(fechar)==="object"){fechar=""}if(typeof(codigorespu)==="object"){codigorespu=""}if(typeof(codigoconfi)==="object"){codigoconfi=""}b.append("<p><h2><b>"+h.NOVEDADMENSAJE.NOVEDADDESCRIPCION+"</b></h2></p><p><h3>Pregunta: <b>"+g+"</b></h3></p><p><h3>Fecha: <b>"+fechap+"</b></h3></p><p><h3>Respuesta: <b>"+d+"</b></h3></p><p><h3>Fecha: <b>"+fechar+'</b></h3></p><label>respuesta</label><input class="respuesta-novedad" type="text" value="" name="RESPUESTA" data-idrespuesta="'+codigorespu+'" data-idconfiguracion="'+codigoconfi+'"/>');b.append('<input class="responde-novedad" type="button" value="enviar" />')}else{if(h.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("input[type='radio']").checkboxradio({create:function(i,j){}});$(".respuesta-novedad").textinput({create:function(i,j){}});$(".responde-novedad").button({create:function(i,j){}});$(".responde-novedad").button("disable");if(d===""){$(".responde-novedad").button("enable")}if(c){$(".responde-novedad").button("disable")}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function responderNovedad(){var b="idUsuario",a=$("#page43 .respuesta-novedad");formData=methods[19]+"&IDUSUARIORESPONDE="+sessionStorage.getItem(b)+"&IDCODIGONOVEDADCONFIGURACIONREPARACIONDETALLE="+a.data("idconfiguracion")+"&RESPUESTA="+a.val()+"&IDCODIGONOVEDADRESPUESTA="+a.data("idrespuesta")+"&VALORADICIONALRESPUESTA=";$.getJSON(url,formData,function(c){if(!c.hasOwnProperty("success")){if(c.RESPUESTA==="True"){alert("Se ha enviado respuesta")}else{alert("No se envio respuesta")}}else{if(c.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function novedadesSistema(){$("#page15 div").remove(".ui-select");$("#page15 .select-novedad").append('<select data-role="none" name="IDCODIGONOVEDADCONFIGURACION" id="novedad-ticket" class="novedades-ticket"></select>');$(".novedades-ticket").selectmenu({create:function(d,e){}});var b="",c,a=$("#page15 #novedad-ticket");c=methods[25];a.html("");$.getJSON(url,c,function(e){$.mobile.loading("hide");$("#btn-send-novedad").button("disable");if(!e.hasOwnProperty("success")){if(e[0]===undefined){b+='<option value="'+e.IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+e.VALORADICIONALPREGUNTA+'">'+e.DESCRIPCION+"</option>"}else{for(var d in e){b+='<option value="'+e[d].IDCODIGONOVEDADCONFIGURACION+'" data-idvaloradicional="'+e[d].VALORADICIONALPREGUNTA+'">'+e[d].DESCRIPCION+"</option>"}}a.html(b);var f=a;f[0].selectedIndex=0;f.selectmenu("refresh")}else{if(e.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function registroNovedad(a,f){var e,c="idReparacion",d="idUsuario",b=sessionStorage.getItem(c);idUsuario=sessionStorage.getItem(d);if(b===null){b=0}e=a+"&"+methods[29]+"&IDUSUARIOPREGUNTA="+idUsuario+"&IDREPARACION="+b+"&IDSOLICITUD="+f;$.getJSON(url,e,function(g){$.mobile.loading("hide");if(!g.hasOwnProperty("success")){if(g.RESPUESTA==="True"){$(".text-novedades").val("");$(".novedades-ticket").val(0);$(".novedades-almacen-general").val(0);alert("Se ha enviado la novedad");if($("#form-novedades-ticket").data("novedad")==="2"){opcionesGestionReparaccion();$.mobile.changePage($("#page5"),{transition:"none"})}else{$.mobile.changePage($("#page3"),{transition:"none"})}}}else{if(g.success==="error"){alert("No se pudo enviar la novedad");$(".btn-novedad-partes").button("enable");$("#btn-send-novedad").button("enable")}else{$(".btn-novedad-partes").button("enable");$("#btn-send-novedad").button("enable")}}}).error(function(){$.mobile.loading("hide");alert("error de conexión");$.mobile.loading("hide");$(".btn-novedad-partes").button("enable");$("#btn-send-novedad").button("enable")})}function mapListadoIng(){var c="",d,b="idUsuario",a=$("#page26 div[data-role='content'] ul");d=methods[26]+"&"+b+"="+sessionStorage.getItem(b);$.getJSON(url,d,function(h){a.html("");a.append('<li data-role="list-divider" role="heading">Ingenieros</li>');if(!h.hasOwnProperty("success")){initializeMaplist(h[0].LATITUD.replace(",","."),h[0].LONGITUD.replace(",","."));var e=[],i,j;for(var g in h){var f=[];c+='<li data-theme="c"><a href="" data-transition="none" data-idingeniero="'+h[g].IDUSUARIO+'">Ing. '+h[g].NOMBREUSUARIO+" "+h[g].APELLIDOUSUARIO+"</a></li>";i=h[g].LATITUD.replace(",","."),j=h[g].LONGITUD.replace(",",".");nombre=h[g].NOMBREUSUARIO;f.nombre=nombre;f.localiza=new google.maps.LatLng(i,j);e[g]=f}a.append(c);crearMarkerMap(e);$("#list-ingenieros a").click(function(k){k.preventDefault();serviciosIngeniero($(this).data("idingeniero"),$(this).text())})}else{if(h.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("#list-ingenieros").listview({create:function(k,l){}});$("#list-ingenieros").listview("refresh")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}var map;function initializeMaplist(e,c){$.mobile.loading("hide");var d=new google.maps.LatLng(e,c),a={zoom:10,center:d,mapTypeId:google.maps.MapTypeId.ROADMAP};var b=$("#page26 #map-list-ing");b.height(screen.height*0.3);map=new google.maps.Map(b[0],a)}function crearMarkerMap(b){for(var d in b){var a=new google.maps.Marker({position:b[d].localiza,map:map,title:b[d].nombre})}if(b[1]!==undefined){var c=new google.maps.LatLngBounds(b[1].localiza,b[0].localiza);map.fitBounds(c)}}function serviciosIngeniero(c,b){$.mobile.changePage($("#page30"),{transition:"none"});$.mobile.loading("show");var e,d="",a=$("#page30 div[data-role='content'] ul");e=methods[27]+"&idUsuario="+c;a.html("");$("#page30 div[data-role='content'] h3").html("");$("#page30 div[data-role='content'] h3").append(b);$.getJSON(url,e,function(g){a.append('<li data-role="list-divider" role="heading">Asignaciones</li>');$("#list-servicios-ing").listview({create:function(h,i){}});if(!g.hasOwnProperty("success")){for(var f in g){d+='<li data-theme="c"><a href="" data-transition="none" data-idreparacion="'+g[f].IDREPARACION+'">Servicio: '+g[f].IDTICKET+" /Estado: "+g[f].ESTADO+"</a></li>"}a.append(d)}else{if(g.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("#list-servicios-ing").listview("refresh");$("#list-servicios-ing a").click(function(h){cambioIngeniero($(this).data("idreparacion"),$(this).text())});$("#page30 div[data-role='content']").fieldcontain("refresh");$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function cambioIngeniero(a,c){$.mobile.changePage($("#page31"),{transition:"none"});$.mobile.loading("show");var e,d="idUsuario",b=$("#page31 div[data-role='content'] form");e=methods[26]+"&"+d+"="+sessionStorage.getItem(d);b.html("");$.getJSON(url,e,function(g){b.append('<div data-role="fieldcontain"><fieldset data-role="controlgroup" data-type="vertical"><legend>Ingenieros</legend></div>');if(!g.hasOwnProperty("success")){for(var f in g){b.find("div[data-role='fieldcontain'] fieldset").append('<input name="idUsuario" id="radio'+f+'" value="'+g[f].IDUSUARIO+'" type="radio" /><label for="radio'+f+'">'+g[f].NOMBREUSUARIO+" "+g[f].APELLIDOUSUARIO+"</label>")}b.append('<a data-role="button" data-transition="none" href="#page26" id="btn-cambio-ing" data-idreparacion="'+a+'">Aceptar</a>')}else{if(g.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$("#page31 div[data-role='content']").fieldcontain("refresh");b.find("input[type='radio']").checkboxradio({create:function(h,i){}});$("#btn-cambio-ing").button({create:function(h,i){$(this).click(function(j){asignaIngeniero(b.serialize(),$(this).data("idreparacion"))})}});$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function asignaIngeniero(c,a){var b="idUsuario";c=methods[28]+"&idReparacion="+a+"&idIngenieroLider="+sessionStorage.getItem(b)+"&"+c;$.getJSON(url,c,function(d){if(!d.hasOwnProperty("success")){if(d.CAMBIOSATISFACTORIO==="True"){alert("Se ha asignado nuevo ingeniero")}}else{if(d.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function mensajesSinleer(){var b="idUsuario",c="",a=$("#page40 div[data-role='content'] ul");formData=methods[43]+"&idUsuarioConsulta="+sessionStorage.getItem(b);a.html("");$.getJSON(url,formData,function(e){if(!e.hasOwnProperty("success")){$.mobile.loading("hide");a.append('<li data-role="list-divider" role="heading">Mensajes sin leer</li>');if(e.NOVEDADMENSAJE[0]===undefined){c+='<li data-theme="c"><a href="" data-transition="none" class="msn-detalle-novedad" data-pantalla="#'+e.NOVEDADMENSAJE.NAVEGACIONMOVILIDAD+'" data-idcodigo="'+e.NOVEDADMENSAJE.IDCODIGONOVEDADCONFIGURACIONREPARACIONDETALLE+'" data-idticket="'+e.NOVEDADMENSAJE.IDTICKET+'" style="padding-bottom: 0;">Ticket: '+e.NOVEDADMENSAJE.IDTICKET+": "+e.NOVEDADMENSAJE.NOVEDADDESCRIPCION+'</a><span style= "margin-left: 15px;font-size: 14px;color: rgb(163, 158, 158);font-weight: normal;">'+e.NOVEDADMENSAJE.FECHAPREGUNTA+"</span></li>"}else{for(var d in e.NOVEDADMENSAJE){c+='<li data-theme="c"><a href="" data-transition="none" class="msn-detalle-novedad" data-pantalla="#'+e.NOVEDADMENSAJE[d].NAVEGACIONMOVILIDAD+'" data-idcodigo="'+e.NOVEDADMENSAJE[d].IDCODIGONOVEDADCONFIGURACIONREPARACIONDETALLE+'" data-idticket="'+e.NOVEDADMENSAJE[d].IDTICKET+'" style="padding-bottom: 0;">Ticket: '+e.NOVEDADMENSAJE[d].IDTICKET+": "+e.NOVEDADMENSAJE[d].NOVEDADDESCRIPCION+'</a><span style= "margin-left: 15px;font-size: 14px;color: rgb(163, 158, 158);font-weight: normal;">'+e.NOVEDADMENSAJE[d].FECHAPREGUNTA+"</span></li>"}}a.append(c);a.listview({create:function(f,g){}});a.listview("refresh")}else{if(e.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}$('#page43 div[data-role="header"] a[data-icon="back"]').attr("href","#page40");$.mobile.loading("hide")}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function marcarNovedadLeida(b){var a=methods[45]+"&idCodigoNovedadConfiguracionReparacionDetalle="+b;$.getJSON(url,a,function(c){if(!c.hasOwnProperty("success")){if(c.RESPUESTA==="True"){var d=$("#page3 li #cantidad-mensajes").text();if(d>0){d-=1}$("#page3 li #cantidad-mensajes").html(d)}}else{if(c.success==="error"){alert("error de conexión");$.mobile.loading("hide")}else{$.mobile.loading("hide")}}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}function resumenCierre(){var c,a="idTicket",b="idUsuario";c=methods[46]+"&"+a+"="+sessionStorage.getItem(a)+"&"+b+"="+sessionStorage.getItem(b);$.getJSON(url,c,function(d){if(d.SATISFACTORIO==="True"){alert("Se ha enviado resumen de cierre");reloadMenuOption()}else{alert("No se pudo enviar resumen de cierre");$.mobile.changePage($("#page5"),{transition:"none"})}}).error(function(){alert("error de conexión");$.mobile.loading("hide")})}$(".msn-detalle-novedad").live("click",function(){marcarNovedadLeida($(this).data("idcodigo"));var a;if($(this).data("pantalla").search("object")===2){if($(this).data("tipo")==="generado"){$(".responde-novedad").button("disable");a=true}else{$(".responde-novedad").button("enable");a=false}$.mobile.changePage($("#page43"),{transition:"none"});obtenerNovedad($(this).data("idcodigo"),a)}else{sessionStorage.setItem("idTicket",$(this).data("idticket"));opcionesGestionReparaccion();page=$(this).data("pantalla");$.mobile.changePage($(page),{transition:"none"})}});$(".novedades-ticket").live("change",function(a,b){$select=$(".novedades-ticket option:selected");if($select.data("idvaloradicional")==="True"){$("div.div-adicional").show()}if($select.val()>"0"){$("#btn-send-novedad").button("enable")}});$(".novedades-almacen-general").live("change",function(){$select=$(this).find("option:selected");$form=$(this).closest('div[data-role="fieldcontain"]');if($select.data("idvaloradicional")==="True"){$form.find("div.div-adicional-almacen").show()}if($select.val()>"0"){$form.find(".btn-novedad-partes").button("enable")}});$(".responde-novedad").live("click",function(){responderNovedad()});$("#list-actividades a").click(function(a){detalleActividades($(this).data("idSolicitud"),$(this).data("idCoordinacion"))});var dataPost,idModulo;$(".btn-save-module").live("click",function(a){a.preventDefault();$btn=$(this);$form=$btn.closest("form");$.mobile.loading("show");$btn.button("disable");a.preventDefault();seleccausa=$form.find(".causal-menu2 option:selected");selecproblema=$form.find(".problems-menu1 option:selected");selecrepara=$form.find(".reparacion-menu4 option:selected");seleccierre=$form.find(".cierre-menu3 option:selected");if(seleccausa.val()>"0"&&seleccierre.val()>"0"&&selecrepara.val()>"0"&&selecproblema.val()>"0"){var b=$form.serialize(),l="&NUEVO=FALSE",h="idReparacion";idModulo=$form.data("idmoduleticket");if($form.data("modulo")){l="&NUEVO=TRUE"}var f=b.split("&"),j=0;b="";for(var e=0;e<f.length;e++){if(f[e].search("CANT")<0){b+="&"+f[e]}else{e=f.length}}b=methods[12]+b+"&IDMODULOEQUIPOTICKET="+idModulo+l+"&IDREPARACION="+sessionStorage.getItem(h);dataPost=b;data=b.split("&");var d=new Object();for(var c in data){subdata=data[c].split("=");d[subdata[0]]=subdata[1]}var g=JSON.stringify(d);if(typeof(FileUploadOptions)==="undefined"){sendWhitoutImage()}else{sendWhitFoto(d)}}else{$btn.button("enable");$.mobile.loading("hide");alert("Falta selección")}});function sendWhitFoto(c){var b=document.getElementById("smallImage");imageURI=b.src;var a=new FileUploadOptions();a.fileKey="IMAGENDESPUES";a.fileName=imageURI.substr(imageURI.lastIndexOf("/")+1);a.mimeType="image/jpeg";a.params=c;var d=new FileTransfer();d.upload(imageURI,url1,successSend,failSend,a)}function successSend(a){$.mobile.loading("hide");if(typeof(a.response)==="string"){if(a.response.search("RESPUESTA")>-1){processResponse()}else{$btn.button("enable")}}else{if(!a.response.hasOwnProperty("success")){if(a.response.RESPUESTA==="True"){processResponse()}}else{$btn.button("enable")}}}function processResponse(){var a=[];$btn.closest("div.module-collapse").find("h3 a").css("background","rgba(0, 0, 0, 0.1)");$btn.closest("div.module-collapse").find("h3 a").css("color","#459CD6");alert("Se ha cerrado el modulo");cerrarParteModuloDetalle(idModulo);var c={id:$form.data("idmoduleticket"),nombre:$form.data("namemodulo"),problema:$form.find(".problema").find(":selected").text(),causal:$form.find(".causal").find(":selected").text(),cierre:$form.find(".cierre").find(":selected").text(),reparacion:$form.find(".reparacion").find(":selected").text(),descripcion:$form.find(".texarea-description").val()};datajson=sessionStorage.getItem("modulo");sessionStorage.removeItem("modulo");datajson=JSON.parse(datajson);for(var b in datajson){a.push(datajson[b])}a.push(c);datajson=JSON.stringify(a);sessionStorage.setItem("modulo",datajson)}function failSend(a){if(a.code===1){sendWhitoutImage()}else{alert("ocurrio un error al cargar la foto");$.mobile.loading("hide");$btn.button("enable")}}function sendWhitoutImage(){var b=[];formData=dataPost;var a=$.ajax({url:url1,type:"POST",crossDomain:true,data:formData,dataType:"text json",success:function(c){$.mobile.loading("hide");if(!c.hasOwnProperty("success")){if(c.RESPUESTA==="True"){processResponse()}}else{$btn.button("enable")}}})}function limpiaSearch(){document.getElementById("form-search-partes").reset();$("#list-search-partes").html("");$("#lista-solicitar-partes").html("");$("#list-search-partes a").css("background","");$("#list-search-partes a").css("color","")};